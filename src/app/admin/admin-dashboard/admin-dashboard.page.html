<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Brunei Ferry Admin Dashboard</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="loadDashboardData()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="dashboard-container">
    <!-- Welcome Section -->
    <ion-card class="welcome-card" *ngIf="currentAdmin">
      <ion-card-content>
        <div class="welcome-content">
          <ion-icon name="person-circle" class="admin-avatar"></ion-icon>
                           <div class="welcome-text">
                   <h2>Welcome back, {{ currentAdmin.name }}!</h2>
                   <p>Role: {{ getRoleDisplayName(currentAdmin.role) }} | Username: {{ currentAdmin.username }}</p>
                   <p>Manage your Brunei ferry operations efficiently</p>
                 </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Main Action Cards -->
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card (click)="goToBookingView()" class="action-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="list" color="primary"></ion-icon>
                Booking View
              </ion-card-title>
              <ion-card-subtitle>View and manage all bookings</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p>Access complete booking information, update statuses, and manage passenger details.</p>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-card (click)="goToChangeDelay()" class="action-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="time" color="warning"></ion-icon>
                Change Delay
              </ion-card-title>
              <ion-card-subtitle>Update ferry schedules and delays</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p>Modify departure times, update delays, and manage ferry schedules.</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card (click)="goToNotifications()" class="action-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="notifications" color="success"></ion-icon>
                Send Notifications
              </ion-card-title>
              <ion-card-subtitle>Notify users about status changes</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p>Send notifications for payment confirmation, booking cancellation, ferry delays, and schedule changes.</p>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-card (click)="openQRScanner()" class="action-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="qr-code" color="tertiary"></ion-icon>
                QR Code Scanner
              </ion-card-title>
              <ion-card-subtitle>Scan boarding passes</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p>Scan QR codes on boarding passes to verify passenger check-ins and manage boarding.</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Recent Notifications -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="notifications-outline"></ion-icon>
          Recent Notifications
          <ion-badge *ngIf="unreadNotificationsCount > 0" color="danger" class="notification-badge">
            {{ unreadNotificationsCount }}
          </ion-badge>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let notification of notifications" 
                    [class.unread]="!notification.isRead"
                    (click)="markNotificationAsRead(notification.id)">
            <ion-icon [name]="getNotificationIcon(notification.type)" 
                      [color]="getNotificationColor(notification.type)" 
                      slot="start"></ion-icon>
            <ion-label>
              <h3>{{ notification.message }}</h3>
              <p>{{ notification.timestamp | date:'short' }}</p>
            </ion-label>
            <ion-badge *ngIf="!notification.isRead" color="danger">New</ion-badge>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Recent Bookings -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="calendar-outline"></ion-icon>
          Recent Bookings
        </ion-card-title>
        <ion-button fill="clear" slot="end" (click)="goToBookingView()">
          View All
        </ion-button>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let booking of recentBookings">
            <ion-label>
              <h3>{{ booking.passengerName }}</h3>
              <p><strong>ID:</strong> {{ booking.id }} | <strong>Route:</strong> {{ booking.ferryRoute }}</p>
              <p><strong>Date:</strong> {{ booking.departureDate }} | <strong>Time:</strong> {{ booking.departureTime }}</p>
              <p><strong>Status:</strong> 
                <ion-badge [color]="booking.status === 'Confirmed' ? 'success' : 'warning'">
                  {{ booking.status }}
                </ion-badge>
              </p>
            </ion-label>
            <ion-note slot="end">
              <strong>BND {{ booking.amount }}</strong>
            </ion-note>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading dashboard...</p>
  </div>
</ion-content> 